<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asesor Virtual Universitario</title>
    <link rel="stylesheet" href="../static/style.css">
    <style>
    body {
        background: #0d0d0d;
        color: #ffffff;
        font-family: "Segoe UI", sans-serif;
    }

    /* Caja de resultados */
    #resultadoBox {
        margin-top: 25px;
        padding: 20px;
        border-radius: 12px;
        background: #111;
        box-shadow: 0 3px 15px rgba(0, 0, 0, 0.6);
        animation: aparecer 0.4s ease;
        color: #e6e6e6;
    }

    @keyframes aparecer {
        from { opacity: 0; transform: translateY(10px); }
        to   { opacity: 1; transform: translateY(0); }
    }

    /* Secci칩n */
    .res-section {
        margin-top: 25px;
        padding: 15px;
        background: #1a1a1a;
        border-left: 4px solid #4a90e2;
        border-radius: 10px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.5);
    }

    .res-title {
        font-size: 1.3em;
        font-weight: bold;
        margin-bottom: 12px;
        color: #76b3ff;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    /* Recomendaci칩n individual */
    .rec-item {
        background: #222;
        padding: 14px;
        border-radius: 8px;
        margin-bottom: 12px;
        border: 1px solid #333;
        transition: 0.2s;
        color: #f2f2f2;
        box-shadow: 0 2px 6px rgba(0,0,0,0.4);
    }

    .rec-item:hover {
        transform: scale(1.02);
        background: #2a2a2a;
    }

    .rec-text {
        font-weight: 600;
        color: #9cc9ff;
    }

    .rec-why {
        font-size: 0.9em;
        color: #cccccc;
        margin-top: 5px;
    }

    /* Materias */
    .mat-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
        gap: 12px;
        margin-top: 10px;
    }

    .mat-item {
        background: #1b1b1b;
        padding: 12px;
        border-radius: 10px;
        border-left: 4px solid #2ecc71;
        box-shadow: 0 2px 6px rgba(0,0,0,0.4);
        transition: 0.2s;
        color: #e8e8e8;
    }

    .mat-item:hover {
        transform: translateY(-2px);
        background: #242424;
    }

    /* Loader */
    .success-message {
        animation: fadeIn 0.3s;
        color: #76b3ff;
    }

    .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #333;
        border-top-color: #4a90e2;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin: 0 auto;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to   { opacity: 1; }
    }
</style>
    <link rel="shortcut icon" href="../static/G7-Icono.ico" type="image/x-icon">
</head>

<body>
    <div class="login-container" style="max-width: 1200px">
        <div class="login-card">
            <div class="login-header">
                <div class="logo-icon"><img src="../static/G7-Logo.jpeg" alt="" width="100px" height="100px"></div>
                <h2>Asesor Virtual Universitario</h2>
                <p>Completa el formulario para obtener recomendaciones personalizadas</p>
            </div>

            <!-- FORMULARIO -->
            <form id="loginForm" class="login-form" novalidate>

                <div class="section-title">Informaci칩n Personal</div>

                <div class="form-row">
                    <div class="form-group">
                        <div class="input-wrapper">
                            <input type="text" id="nombre" name="nombre" required>
                            <label for="nombre">Nombre Completo</label>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="input-wrapper">
                            <input type="number" id="edad" name="edad" required min="16" max="100">
                            <label for="edad">Edad</label>
                        </div>
                    </div>
                </div>


                <div class="section-title">Situaci칩n del Estudiante</div>
                <div class="form-group"> <label class="select-label">Nivel</label>
                    <div class="select-wrapper"> <select id="nivel" name="nivel" required>
                            <option value="">Selecciona una opci칩n</option>
                            <option value="ingresante">Ingresante</option>
                            <option value="intermedio">Intermedio</option>
                            <option value="avanzado">Avanzado</option>
                        </select> <span class="select-arrow"></span> </div> <span class="error-message"
                        id="nivelError"></span>
                </div>
                <!-- TRABAJA -->
                <div class="form-group">
                    <label class="radio-group-label">쯊rabaja?</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="trabaja" value="si" required>
                            <span class="radio-text">Si</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="trabaja" value="no" required>
                            <span class="radio-text">No</span>
                        </label>
                    </div>
                </div>

                <!-- HOLGURA -->
                <div class="form-group">
                    <label class="radio-group-label">쮻ispone de tiempo de holgura?</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="horario" value="si" required>
                            <span class="radio-text">Si</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="horario" value="no" required>
                            <span class="radio-text">No</span>
                        </label>
                    </div>
                </div>

                <!-- DISTANCIA -->
                <div class="form-group">
                    <label class="radio-group-label">Reside lejos de la facultad?</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="distancia" value="si" required>
                            <span class="radio-text">Si</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="distancia" value="no" required>
                            <span class="radio-text">No</span>
                        </label>
                    </div>
                </div>

                <!-- HORAS SEMANALES -->
                <div class="form-group">
                    <label class="range-label">
                        Horas disponibles en la semana:
                        <span id="presupuestoValue">10 hs</span>
                    </label>

                    <input type="range" id="horas" name="horas" min="1" max="50" value="10" step="1"
                        class="range-input">

                    <div class="range-labels">
                        <span>1 hs</span>
                        <span>50 hs</span>
                    </div>
                </div>
                <!-- <div class="form-group"> <label class="select-label">Modalidad de cursado que prefiere</label> <div class="select-wrapper"> <select id="area" name="area" required> <option value="">Selecciona un 치rea</option> <option value="ciencias">Presencial</option> <option value="ingenieria">Virtual</option> <option value="humanidades">H칤brido</option> </select> <span class="select-arrow"></span> </div> <span class="error-message" id="areaError"></span> </div> -->
                <!-- Preferencias -->
                <div class="section-title">Informaci칩n de Estudio</div>
                <div class="form-group"> <label class="checkbox-group-label">Errores que comete generalmente</label>
                    <div class="checkbox-group"> <label class="checkbox-label"> <input type="checkbox" name="intereses"
                                id="terminos" value="programacion"> <span class="custom-checkbox"></span> <span
                                class="checkbox-text">Procrastinacion antes de parciales</span> </label> <label
                            class="checkbox-label"> <input type="checkbox" name="intereses" value="diseno"> <span
                                class="custom-checkbox"></span> <span class="checkbox-text">No revisar
                                cronogramas</span> </label> <label class="checkbox-label"> <input type="checkbox"
                                name="intereses" value="matematicas"> <span class="custom-checkbox"></span> <span
                                class="checkbox-text">Inscribirse en demasiadas materias</span> </label> <label
                            class="checkbox-label"> <input type="checkbox" name="intereses" value="idiomas"> <span
                                class="custom-checkbox"></span> <span class="checkbox-text">Estudiar el ultimo
                                dia</span> </label> <label class="checkbox-label"> <input type="checkbox"
                                name="intereses" value="investigacion"> <span class="custom-checkbox"></span> <span
                                class="checkbox-text">Ignorar correlatividades</span> </label> </div>
                </div>
                <div class="form-group"> <label class="checkbox-group-label">Estrategias de Estudio</label>
                    <div class="checkbox-group"> <label class="checkbox-label"> <input type="checkbox"
                                name="estrategias" value="programacion"> <span class="custom-checkbox"></span> <span
                                class="checkbox-text">Micro-estudios de alrededor de 30 minutos</span> </label> <label
                            class="checkbox-label"> <input type="checkbox" name="estrategias" value="diseno"> <span
                                class="custom-checkbox"></span> <span class="checkbox-text">Rutina semanal
                                estricta</span> </label> <label class="checkbox-label"> <input type="checkbox"
                                name="estrategias" value="matematicas"> <span class="custom-checkbox"></span> <span
                                class="checkbox-text">Estudiar con anticipacion</span> </label> <label
                            class="checkbox-label"> <input type="checkbox" name="estrategias" value="idiomas"> <span
                                class="custom-checkbox"></span> <span class="checkbox-text">Grabar clases para
                                revisar</span> </label> </div>
                </div>
                <div class="form-group"> <label class="radio-group-label">Modalidad de Dictado de clases
                        preferida</label>
                    <div class="radio-group"> <label class="radio-label"> <input type="radio" name="modalidad"
                                value="presencial" required> <span class="custom-radio"></span> <span
                                class="radio-text">Presencial</span> </label> <label class="radio-label"> <input
                                type="radio" name="modalidad" value="virtual" required> <span
                                class="custom-radio"></span> <span class="radio-text">Virtual</span> </label> <label
                            class="radio-label"> <input type="radio" name="modalidad" value="hibrida" required> <span
                                class="custom-radio"></span> <span class="radio-text">H칤brida</span> </label> </div>
                    <!-- <span class="error-message" id="modalidadError"></span> -->
                </div>
                <div class="form-group"> <label class="radio-group-label">Tiempo de Estudio</label>
                    <div class="radio-group"> <label class="radio-label"> <input type="radio" name="tiempo"
                                value="tiempo_bajo" required> <span class="custom-radio"></span> <span
                                class="radio-text">Menos de 10 horas semanales</span> </label> <label
                            class="radio-label"> <input type="radio" name="tiempo" value="tiempo_medio" required> <span
                                class="custom-radio"></span> <span class="radio-text">Entre 10 y 20 horas
                                semanales</span> </label> <label class="radio-label"> <input type="radio" name="tiempo"
                                value="tiempo_alto" required> <span class="custom-radio"></span> <span
                                class="radio-text">M치s de 20 horas semanales</span> </label> </div> <span
                        class="error-message" id="modalidadError"></span>
                </div>

                <div class="section-title">MATERIAS</div>
                <div class="form-group"> <label class="checkbox-group-label">Selecciona todas las aprobadas</label>
                    <div class="checkbox-group"> {% for m in materias %} <label class="checkbox-label"> <input
                                type="checkbox" name="materias_aprobadas" value="{{ m.codigo }}"> <span
                                class="custom-checkbox"></span> <span class="checkbox-text">{{ m.nombre }}</span>
                        </label> {% endfor %} </div>
                </div>

                <!-- BOT칍N -->
                <button type="button" class="login-btn btn" onclick="enviarFormulario()">
                    <span class="btn-text">OBTENER RECOMENDACIONES</span>
                </button>

            </form>

            <!-- RESULTADO DIN츼MICO -->
            <div id="resultadoBox"></div>

            <div class="success-message" id="successMessage"
     style="display:none; text-align:center; margin-top:20px;">
    <div class="spinner"></div>
    <h3 style="margin-top:10px;">Procesando...</h3>
</div>

        </div>
    </div>


    <!-- SCRIPT AJAX -->
    <script>
function enviarFormulario() {
    const form = document.getElementById("loginForm");
    const formData = new FormData(form);
    const resultBox = document.getElementById("resultadoBox");
    const loading = document.getElementById("successMessage");

    loading.style.display = "block";
    resultBox.innerHTML = "";

    fetch("/procesar", {
        method: "POST",
        body: formData
    })
    .then(r => r.json())
    .then(data => {
        loading.style.display = "none";

        if (data.status === "error") {
            resultBox.innerHTML = `<p style="color:#ff8080">Error: ${data.message}</p>`;
            return;
        }

        let html = `<h2 style="color:#76b3ff;">Hola, ${data.usuario}</h2>`;

        /* Recomendaciones */
        html += `
        <div class="res-section">
            <div class="res-title">游 Recomendaciones Personalizadas</div>
        `;

        if (data.recomendaciones.length === 0) {
            html += `<p>No hay recomendaciones espec칤ficas.</p>`;
        } else {
            data.recomendaciones.forEach(rec => {
                html += `
                <div class="rec-item">
                    <div class="rec-text">${rec.texto}</div>
                    <div class="rec-why">游늷 Motivo: ${rec.explicacion}</div>
                </div>`;
            });
        }
        html += `</div>`;

        /* Materias disponibles */
        html += `
        <div class="res-section">
            <div class="res-title">游꿉 Materias Disponibles</div>
            <div class="mat-list">
        `;

        data.materias_disponibles.forEach(mat => {
            html += `
            <div class="mat-item">
                <strong>${mat.nombre}</strong><br>
                <small>A침o: ${mat.anio} | ${mat.modalidad}</small>
            </div>`;
        });

        html += `</div></div>`;

        resultBox.innerHTML = html;
    })
    .catch(err => {
        loading.style.display = "none";
        resultBox.innerHTML = "<p>Ocurri칩 un error al conectar con el servidor.</p>";
    });
}
</script>

    <script>
        const slider = document.getElementById("horas");
        const bubble = document.getElementById("presupuestoValue");

        function updateBubble() {
            const value = slider.value;
            const min = slider.min;
            const max = slider.max;

            // Calcular posici칩n del bubble
            const percent = (value - min) / (max - min);
            const pos = percent * slider.offsetWidth;

            bubble.style.left = pos + "px";
            bubble.textContent = value + " hs";
        }

        updateBubble();

        slider.addEventListener("input", updateBubble);
    </script>
</body>

</html>