<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asesor Virtual Universitario</title>
    <link rel="stylesheet" href="../static/style.css">
    <style>
        /* Estilos r√°pidos para la respuesta */
        .res-section { margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 5px solid #4a90e2; }
        .res-title { font-weight: bold; font-size: 1.2em; color: #333; margin-bottom: 10px; }
        .rec-item { background: white; padding: 10px; margin-bottom: 8px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .rec-text { font-weight: 600; color: #2c3e50; }
        .rec-why { font-size: 0.9em; color: #666; font-style: italic; margin-top: 4px; }
        .mat-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; }
        .mat-item { background: #e3f2fd; padding: 8px; border-radius: 4px; text-align: center; font-size: 0.9em; }
    </style>
   <link rel="shortcut icon" href="/INCO/static/G7-Icono.ico" type="image/x-icon">
</head>

<body>
    <div class="login-container" style="max-width: 1200px">
        <div class="login-card">
            <div class="login-header">
                <div class="logo-icon"><img src="/INCO/static/G7-Icono.ico" alt=""></div>
                <h2>Asesor Virtual Universitario</h2>
                <p>Completa el formulario para obtener recomendaciones personalizadas</p>
            </div>

            <!-- FORMULARIO -->
            <form id="loginForm" class="login-form" novalidate>

                <div class="section-title">Informaci√≥n Personal</div>

                <div class="form-row">
                    <div class="form-group">
                        <div class="input-wrapper">
                            <input type="text" id="nombre" name="nombre" required>
                            <label for="nombre">Nombre Completo</label>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="input-wrapper">
                            <input type="number" id="edad" name="edad" required min="16" max="100">
                            <label for="edad">Edad</label>
                        </div>
                    </div>
                </div>


                <div class="section-title">Situaci√≥n del Estudiante</div>
                <div class="form-group"> <label class="select-label">Nivel</label>
                    <div class="select-wrapper"> <select id="nivel" name="nivel" required>
                            <option value="">Selecciona una opci√≥n</option>
                            <option value="ingresante">Ingresante</option>
                            <option value="intermedio">Intermedio</option>
                            <option value="avanzado">Avanzado</option>
                        </select> <span class="select-arrow"></span> </div> <span class="error-message"
                        id="nivelError"></span>
                </div>
                <!-- TRABAJA -->
                <div class="form-group">
                    <label class="radio-group-label">¬øTrabaja?</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="trabaja" value="si" required>
                            <span class="radio-text">Si</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="trabaja" value="no" required>
                            <span class="radio-text">No</span>
                        </label>
                    </div>
                </div>

                <!-- HOLGURA -->
                <div class="form-group">
                    <label class="radio-group-label">¬øDispone de tiempo de holgura?</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="horario" value="si" required>
                            <span class="radio-text">Si</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="horario" value="no" required>
                            <span class="radio-text">No</span>
                        </label>
                    </div>
                </div>

                <!-- DISTANCIA -->
                <div class="form-group">
                    <label class="radio-group-label">¬øReside lejos de la facultad?</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="distancia" value="si" required>
                            <span class="radio-text">Si</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="distancia" value="no" required>
                            <span class="radio-text">No</span>
                        </label>
                    </div>
                </div>

                <!-- HORAS SEMANALES -->
                <div class="form-group"> <label class="range-label"> Horas disponibles en la semana: <span
                            id="presupuestoValue">10 hs</span> </label> <input type="range" id="horas"
                        name="horas" min="1" max="50" value="10" step="1" class="range-input">
                    <div class="range-labels"> <span>1 hs</span> <span>50 hs</span> </div>
                </div>
                <!-- <div class="form-group"> <label class="select-label">Modalidad de cursado que prefiere</label> <div class="select-wrapper"> <select id="area" name="area" required> <option value="">Selecciona un √°rea</option> <option value="ciencias">Presencial</option> <option value="ingenieria">Virtual</option> <option value="humanidades">H√≠brido</option> </select> <span class="select-arrow"></span> </div> <span class="error-message" id="areaError"></span> </div> -->
                <!-- Preferencias -->
                <div class="section-title">Informaci√≥n de Estudio</div>
                <div class="form-group"> <label class="checkbox-group-label">Errores que comete generalmente</label>
                    <div class="checkbox-group"> <label class="checkbox-label"> <input type="checkbox" name="intereses"
                                id="terminos" value="programacion"> <span class="custom-checkbox"></span> <span
                                class="checkbox-text">Procrastinacion antes de parciales</span> </label> <label
                            class="checkbox-label"> <input type="checkbox" name="intereses" value="diseno"> <span
                                class="custom-checkbox"></span> <span class="checkbox-text">No revisar
                                cronogramas</span> </label> <label class="checkbox-label"> <input type="checkbox"
                                name="intereses" value="matematicas"> <span class="custom-checkbox"></span> <span
                                class="checkbox-text">Inscribirse en demasiadas materias</span> </label> <label
                            class="checkbox-label"> <input type="checkbox" name="intereses" value="idiomas"> <span
                                class="custom-checkbox"></span> <span class="checkbox-text">Estudiar el ultimo
                                dia</span> </label> <label class="checkbox-label"> <input type="checkbox"
                                name="intereses" value="investigacion"> <span class="custom-checkbox"></span> <span
                                class="checkbox-text">Ignorar correlatividades</span> </label> </div>
                </div>
                <div class="form-group"> <label class="checkbox-group-label">Estrategias de Estudio</label>
                    <div class="checkbox-group"> <label class="checkbox-label"> <input type="checkbox"
                                name="estrategias" value="programacion"> <span class="custom-checkbox"></span> <span
                                class="checkbox-text">Micro-estudios de alrededor de 30 minutos</span> </label> <label
                            class="checkbox-label"> <input type="checkbox" name="estrategias" value="diseno"> <span
                                class="custom-checkbox"></span> <span class="checkbox-text">Rutina semanal
                                estricta</span> </label> <label class="checkbox-label"> <input type="checkbox"
                                name="estrategias" value="matematicas"> <span class="custom-checkbox"></span> <span
                                class="checkbox-text">Estudiar con anticipacion</span> </label> <label
                            class="checkbox-label"> <input type="checkbox" name="estrategias" value="idiomas"> <span
                                class="custom-checkbox"></span> <span class="checkbox-text">Grabar clases para
                                revisar</span> </label> </div>
                </div>
                <div class="form-group"> <label class="radio-group-label">Modalidad de Dictado de clases
                        preferida</label>
                    <div class="radio-group"> <label class="radio-label"> <input type="radio" name="modalidad"
                                value="presencial" required> <span class="custom-radio"></span> <span
                                class="radio-text">Presencial</span> </label> <label class="radio-label"> <input
                                type="radio" name="modalidad" value="virtual" required> <span
                                class="custom-radio"></span> <span class="radio-text">Virtual</span> </label> <label
                            class="radio-label"> <input type="radio" name="modalidad" value="hibrida" required> <span
                                class="custom-radio"></span> <span class="radio-text">H√≠brida</span> </label> </div>
                    <!-- <span class="error-message" id="modalidadError"></span> -->
                </div>
                <div class="form-group"> <label class="radio-group-label">Tiempo de Estudio</label>
                    <div class="radio-group"> <label class="radio-label"> <input type="radio" name="tiempo"
                                value="presencial" required> <span class="custom-radio"></span> <span
                                class="radio-text">Menos de 10 horas semanales</span> </label> <label
                            class="radio-label"> <input type="radio" name="tiempo" value="virtual" required> <span
                                class="custom-radio"></span> <span class="radio-text">Entre 10 y 20 horas
                                semanales</span> </label> <label class="radio-label"> <input type="radio" name="tiempo"
                                value="hibrida" required> <span class="custom-radio"></span> <span
                                class="radio-text">M√°s de 20 horas semanales</span> </label> </div> <span
                        class="error-message" id="modalidadError"></span>
                </div>

                <div class="section-title">MATERIAS</div>
                <div class="form-group"> <label class="checkbox-group-label">Selecciona todas las aprobadas</label>
                    <div class="checkbox-group"> {% for m in materias %} <label class="checkbox-label"> <input
                                type="checkbox" name="materias_aprobadas" value="{{ m.codigo }}"> <span
                                class="custom-checkbox"></span> <span class="checkbox-text">{{ m.nombre }}</span>
                        </label> {% endfor %} </div>
                </div>

                <!-- BOT√ìN -->
                <button type="button" class="login-btn btn" onclick="enviarFormulario()">
                    <span class="btn-text">OBTENER RECOMENDACIONES</span>
                </button>

            </form>

            <!-- RESULTADO DIN√ÅMICO -->
            <div id="resultadoBox"></div>
            
            <div class="success-message" id="successMessage" style="display:none; text-align: center; margin-top: 20px;">
                <div class="success-icon" style="font-size: 2em;">‚è≥</div>
                <h3>Procesando...</h3>
            </div>

        </div>
    </div>


    <!-- SCRIPT AJAX -->
    <script>
        function enviarFormulario() {
            const form = document.getElementById("loginForm");
            const formData = new FormData(form);
            const resultBox = document.getElementById("resultadoBox");
            const loading = document.getElementById("successMessage");

            // Mostrar carga
            loading.style.display = "block";
            resultBox.innerHTML = "";

            fetch("/procesar", {
                method: "POST",
                body: formData
            })
            .then(r => r.json())
            .then(data => {
                loading.style.display = "none";

                if(data.status === "error") {
                    resultBox.innerHTML = `<p style="color:red">Error: ${data.message}</p>`;
                    return;
                }

                // Construir HTML de respuesta
                let html = `<h2>Hola, ${data.usuario}</h2>`;

                // 1. Mostrar Recomendaciones
                html += `<div class="res-section" ><div class="res-title">üí° Tus Recomendaciones Personalizadas</div>`;
                if(data.recomendaciones.length === 0){
                    html += `<p>No hay recomendaciones espec√≠ficas por ahora.</p>`;
                } else {
                    data.recomendaciones.forEach(rec => {
                        html += `
                        <div class="rec-item">
                            <div class="rec-text">${rec.texto}</div>
                            <div class="rec-why">üîé Por qu√©: ${rec.explicacion}</div>
                        </div>`;
                    });
                }
                html += `</div>`;

                // 2. Mostrar Materias Disponibles
                html += `<div class="res-section"><div class="res-title">üìö Materias que puedes cursar YA</div>`;
                html += `<div class="mat-list">`;
                if(data.materias_disponibles.length === 0){
                    html += `<p>No tienes materias disponibles (o ya terminaste).</p>`;
                } else {
                    data.materias_disponibles.forEach(mat => {
                        html += `<div class="mat-item">
                                    <strong>${mat.nombre}</strong><br>
                                    <small>A√±o: ${mat.anio} | ${mat.modalidad}</small>
                                 </div>`;
                    });
                }
                html += `</div></div>`;

                resultBox.innerHTML = html;
            })
            .catch(err => {
                console.error("Error:", err);
                loading.style.display = "none";
                resultBox.innerHTML = "<p>Ocurri√≥ un error al conectar con el servidor.</p>";
            });
        }
    </script>

</body>

</html>